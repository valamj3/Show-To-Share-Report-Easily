<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üöÄ Show-To Social</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f0f2f5;
}
header{
  background:#1877f2;
  color:white;
  padding:15px;
  text-align:center;
  font-size:22px;
}
.container{
  max-width:500px;
  margin:auto;
  padding:15px;
}
.card{
  background:white;
  padding:15px;
  margin-top:15px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
input,textarea{
  width:100%;
  padding:10px;
  margin:5px 0;
  border-radius:6px;
  border:1px solid #ccc;
}
button{
  width:100%;
  padding:10px;
  margin-top:5px;
  background:#1877f2;
  color:white;
  border:none;
  border-radius:6px;
}
button.red{background:red;}
.post img{
  width:100%;
  border-radius:8px;
  margin-top:8px;
}
.like{
  color:red;
  cursor:pointer;
}
</style>
</head>

<body>

<header>üöÄ Show-To Social</header>

<div class="container">

<div id="authBox" class="card">
<h3>Sign Up / Login</h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="signUp()">Sign Up</button>
<button onclick="login()">Login</button>
<p id="authMsg"></p>
</div>

<div id="app" style="display:none">

<div class="card">
<p id="welcome"></p>
<button class="red" onclick="logout()">Logout</button>
</div>

<div class="card">
<h3>Create Post</h3>
<textarea id="postText" placeholder="What's on your mind?"></textarea>
<input type="file" id="imageInput">
<button onclick="createPost()">Post</button>
</div>

<div id="posts"></div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc, increment } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "show-to-cdf74.firebaseapp.com",
  projectId: "show-to-cdf74",
  storageBucket: "show-to-cdf74.firebasestorage.app",
  messagingSenderId: "608425909130",
  appId: "1:608425909130:web:c9b9c46ebb07485cf8c673"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

window.signUp = async function(){
  try{
    await createUserWithEmailAndPassword(auth,email.value,password.value);
    authMsg.innerText="Signup Success ‚úÖ";
  }catch(e){authMsg.innerText=e.message;}
}

window.login = async function(){
  try{
    await signInWithEmailAndPassword(auth,email.value,password.value);
    authMsg.innerText="Login Success ‚úÖ";
  }catch(e){authMsg.innerText=e.message;}
}

window.logout = function(){
  signOut(auth);
}

onAuthStateChanged(auth,(user)=>{
  if(user){
    authBox.style.display="none";
    app.style.display="block";
    welcome.innerText="Welcome "+user.email;
  }else{
    authBox.style.display="block";
    app.style.display="none";
  }
});

window.createPost = async function(){
  let imageUrl="";
  let file=imageInput.files[0];

  if(file){
    let formData=new FormData();
    formData.append("file",file);
    formData.append("upload_preset","c901a1efe41ceef9695fdd474ee6bc");

    let res=await fetch("https://api.cloudinary.com/v1_1/mukeshdengada/image/upload",{
      method:"POST",
      body:formData
    });
    let data=await res.json();
    imageUrl=data.secure_url;
  }

  await addDoc(collection(db,"posts"),{
    text:postText.value,
    image:imageUrl,
    user:auth.currentUser.email,
    likes:0,
    created:Date.now()
  });

  postText.value="";
  imageInput.value="";
}

onSnapshot(collection(db,"posts"),(snap)=>{
  posts.innerHTML="";
  snap.forEach(docu=>{
    let p=docu.data();
    posts.innerHTML+=`
    <div class="card post">
      <b>${p.user}</b>
      <p>${p.text}</p>
      ${p.image?`<img src="${p.image}">`:""}
      <p>
      <span class="like" onclick="likePost('${docu.id}')">‚ù§Ô∏è ${p.likes}</span>
      <button onclick="deletePost('${docu.id}')">Delete</button>
      </p>
    </div>`;
  });
});

window.likePost=async function(id){
  await updateDoc(doc(db,"posts",id),{
    likes:increment(1)
  });
}

window.deletePost=async function(id){
  await deleteDoc(doc(db,"posts",id));
}
</script>

</body>
</html>
