<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Show-To Social</title>

<style>
body {margin:0;font-family:Arial;background:#eef1f5;}
header {background:#1877f2;color:white;padding:15px;text-align:center;}
.container {max-width:600px;margin:auto;padding:20px;}
.card {background:white;padding:15px;border-radius:10px;margin-bottom:15px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
input, textarea {width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ccc;}
button {background:#1877f2;color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;}
.like-btn {background:#eee;color:#333;margin-right:5px;}
.logout {background:red;margin-top:10px;}
.hidden {display:none;}
</style>
</head>

<body>

<header>üöÄ Show-To Social</header>

<div class="container">

<div class="card" id="authBox">
<h3>Login / Sign Up</h3>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="signUp()">Sign Up</button>
<button onclick="login()">Login</button>
</div>

<div id="appSection" class="hidden">

<div class="card">
<h3>Welcome <span id="userEmail"></span></h3>
<button class="logout" onclick="logout()">Logout</button>
</div>

<div class="card">
<h3>Create Post</h3>
<textarea id="message" placeholder="What's on your mind?"></textarea>
<button onclick="savePost()">Post</button>
</div>

<div id="posts"></div>

</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy, updateDoc, deleteDoc, doc, increment }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCT2YXbRSsVj4LHyvuz0r2uKlw6beo6Jn8",
  authDomain: "show-to-cdf74.firebaseapp.com",
  projectId: "show-to-cdf74",
  storageBucket: "show-to-cdf74.firebasestorage.app",
  messagingSenderId: "608425909130",
  appId: "1:608425909130:web:c9b9c46ebb07485cf8c673"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

window.signUp = async function(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  await createUserWithEmailAndPassword(auth, email, password);
}

window.login = async function(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  await signInWithEmailAndPassword(auth, email, password);
}

window.logout = async function(){
  await signOut(auth);
}

onAuthStateChanged(auth, user=>{
  if(user){
    document.getElementById("authBox").classList.add("hidden");
    document.getElementById("appSection").classList.remove("hidden");
    document.getElementById("userEmail").innerText = user.email;
    loadPosts();
  } else {
    document.getElementById("authBox").classList.remove("hidden");
    document.getElementById("appSection").classList.add("hidden");
  }
});

window.savePost = async function(){
  const message = document.getElementById("message").value;
  if(!message) return;

  await addDoc(collection(db,"posts"),{
    message,
    user: auth.currentUser.email,
    likes:0,
    timestamp:new Date()
  });

  document.getElementById("message").value="";
  loadPosts();
}

async function likePost(id){
  await updateDoc(doc(db,"posts",id),{likes:increment(1)});
  loadPosts();
}

async function deletePost(id){
  await deleteDoc(doc(db,"posts",id));
  loadPosts();
}

async function loadPosts(){
  const container=document.getElementById("posts");
  container.innerHTML="";
  const q=query(collection(db,"posts"),orderBy("timestamp","desc"));
  const snap=await getDocs(q);

  snap.forEach(docSnap=>{
    const data=docSnap.data();
    container.innerHTML+=`
      <div class="card">
        <strong>${data.user}</strong>
        <p>${data.message}</p>
        <button class="like-btn" onclick="likePost('${docSnap.id}')">‚ù§Ô∏è ${data.likes}</button>
        <button onclick="deletePost('${docSnap.id}')">Delete</button>
      </div>
    `;
  });
}
</script>

</body>
</html>
