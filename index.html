<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Show-To Social</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial;
  margin:0;
  background:#f0f2f5;
}
header{
  background:#1877f2;
  color:white;
  padding:15px;
  text-align:center;
  font-size:20px;
}
.container{
  max-width:500px;
  margin:auto;
  padding:15px;
}
.card{
  background:white;
  padding:15px;
  margin-top:15px;
  border-radius:8px;
}
button{
  padding:10px;
  border:none;
  border-radius:5px;
  margin-top:8px;
}
.blue{background:#1877f2;color:white;width:100%;}
.red{background:red;color:white;width:100%;}
.dark{
  background:#18191a;
  color:white;
}
.dark .card{
  background:#242526;
}
</style>
</head>

<body>

<header>
ðŸš€ Show-To Social
<button onclick="toggleDark()" style="float:right;">ðŸŒ™</button>
</header>

<div class="container">

<div id="authBox" class="card">
<h3>Sign Up / Login</h3>
<input id="email" placeholder="Email" style="width:100%;padding:8px"><br>
<input id="password" type="password" placeholder="Password" style="width:100%;padding:8px;margin-top:5px">
<button class="blue" onclick="signUp()">Sign Up</button>
<button class="blue" onclick="login()">Login</button>
<p id="authMsg"></p>
</div>

<div id="mainApp" style="display:none;">

<div class="card">
<p id="welcome"></p>
<button class="red" onclick="logout()">Logout</button>
</div>

<div class="card">
<h4>Create Post</h4>
<textarea id="postText" placeholder="Write something..." style="width:100%;padding:8px"></textarea>
<button class="blue" onclick="addPost()">Post</button>
</div>

<div id="posts"></div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBugT-9Twwk0CN9kJi34KWVNHpJkjSTiUA",
  authDomain: "show-to-social.firebaseapp.com",
  projectId: "show-to-social",
  storageBucket: "show-to-social.firebasestorage.app",
  messagingSenderId: "956400922393",
  appId: "1:956400922393:web:3255d708a2f3dea166df88"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

window.signUp = async function(){
  try{
    await createUserWithEmailAndPassword(auth,email.value,password.value);
    authMsg.innerText="Signup Success âœ…";
  }catch(e){
    authMsg.innerText=e.message;
  }
}

window.login = async function(){
  try{
    await signInWithEmailAndPassword(auth,email.value,password.value);
  }catch(e){
    authMsg.innerText=e.message;
  }
}

window.logout = async function(){
  await signOut(auth);
}

onAuthStateChanged(auth,(user)=>{
  if(user){
    authBox.style.display="none";
    mainApp.style.display="block";
    welcome.innerText="Welcome "+user.email;
    loadPosts();
  }else{
    authBox.style.display="block";
    mainApp.style.display="none";
  }
});

window.addPost = async function(){
  if(postText.value==="") return;
  await addDoc(collection(db,"posts"),{
    text:postText.value,
    created:serverTimestamp()
  });
  postText.value="";
  loadPosts();
}

async function loadPosts(){
  posts.innerHTML="";
  const q=query(collection(db,"posts"),orderBy("created","desc"));
  const snap=await getDocs(q);
  snap.forEach(doc=>{
    posts.innerHTML+=`
      <div class="card">
        ${doc.data().text}
      </div>
    `;
  });
}

window.toggleDark=function(){
  document.body.classList.toggle("dark");
}
</script>

</body>
</html>
